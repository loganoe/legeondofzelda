<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            margin: 0;
            font-family: 'Courier New', Courier, monospace
        }
        #background {
            position: absolute;
            z-index: -99;
            top: 200px;
            left: 0px;
        }
        #player {
            position: absolute;
            z-index: 99;
            top: 200px;
            left: 0px; 
        }

    </style>
</head>
<body onload="credits()">
    <canvas width = "1000" height="200" id="GUI">

    </canvas>
    <canvas width="1000" height = "750" id="player"></canvas>
    <canvas width="1000" height = "750" id="background"> </canvas>
    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>     <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>    <br><br>
    <audio controls autoplay loop aria-hidden="true" id="gyatt">
        <source src="Overworld_Theme.mp3" type="audio/mpeg">


    </audio>
    <script defer>
        // how to render levels:

        // development stuff, doesn't matter:
//set up the canvas and context
var canvas = document.getElementById("player");
var ctx = canvas.getContext("2d");
ctx.fillStyle = "rgba(1,1,1,1)";
ctx.fillRect(0, 0, canvas.getAttribute("height"), canvas.getAttribute("width"));

//report the mouse position on click
canvas.addEventListener("click", function (evt) {
   // var mousePos = getMousePos(canvas, evt);
   document.getElementById("gyatt").play();
    //alert(mousePos.x + ',' + mousePos.y);
}, false);

//Get Mouse Position
function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
    };
}
        function credits() {
            console.log("Credit for all sprites and background goes to Mister Mike, at https://www.spriters-resource.com/nes/legendofzelda/sheet/119176/")
        }


        
        setInterval(tick, 8);
var swordx = 0; 
var swordy = 0;       
var lives = 3;
var rupees = 0;
var keys = 0; 
var orbs = 0;
var playerx = 500;
var playery = 500; 
var movingup = false;
var movingdown = false;
var movingright = false;
var movingleft = false;
var footindex = false; 
var didmovelast = false;
var q = 0; 
var clevel = 1;
var swordon = false;
// defensive commenting: 
// detect the keypresses (yea it is inefficient but i have plenty of storage to work with, ok)
        window.onkeydown = function (e) {
            if (e.key === "z") {
                if (swordcol == true) {
                swordon = true;
                swordx = playerx;
                swordy = playery;
                }
            }
            if (e.key === "p" ) {
                location.href = "https://davidsongifted.instructure.com";
            }
            if (e.key === "w") {
                console.log("muchup");
                movingup = true;
                movingleft = false;
                movingdown = false;
                movingright = false;
            }
            if (e.key === "a") {
                console.log("muchleft");
                movingup = false;
                movingleft = true;
                movingdown = false;
                movingright = false;
            }
            if (e.key === "d") {
                console.log("muchright");
                movingup = false;
                movingleft = false;
                movingdown = false;
                movingright = true;
            } 
            if (e.key === "s") {
                console.log("muchdown");
                movingup = false;
                movingleft = false;
                movingdown = true;
                movingright = false;
            }
        }
        window.onkeyup = function (e) {
            if (e.key === "w") {
                console.log("muchup");
                movingup = false;
                movingleft = false;
                movingdown = false;
                movingright = false;
            }
            if (e.key === "a") {
                console.log("muchleft");
                movingup = false;
                movingleft = false;
                movingdown = false;
                movingright = false;
            }
            if (e.key === "d") {
                console.log("muchright");
                movingup = false;
                movingleft = false;
                movingdown = false;
                movingright = false;
            } 
            if (e.key === "s") {
                console.log("muchdown");
                movingup = false;
                movingleft = false;
                movingdown = false;
                movingright = false;
            }
        }
        var magic = 1;




                    //bctx.drawImage(bg, 0, 0, 1000, 750); 

        // preload all of them images
        var heart = new Image();
        heart.src = "backgrounds/heart.png";
        var icons = new Image();
        icons.src = "backgrounds/icons.png";
        var linkdown1 = new Image();
        linkdown1.src = "backgrounds/front1.png";
        var linkdown2 = new Image();
        linkdown2.src = "backgrounds/front2.png";
        var linkup1 = new Image();
        linkup1.src = "backgrounds/linkup1.png";
        var linkup2 = new Image();
        linkup2.src = "backgrounds/linkup2.png";
        var linkright1 = new Image();
        linkright1.src = "backgrounds/linkright1.png";
        var linkright2 = new Image();
        linkright2.src = "backgrounds/linkright2.png";
        var linkl1 = new Image();
        linkl1.src = "backgrounds/linkleft1.png";
        var linkl2 = new Image();
        linkl2.src = "backgrounds/linkleft2.png";
        var bg =  new Image();
        bg.src = "backgrounds/bg1.png";
        var bg2 =  new Image();
        bg2.src = "backgrounds/bg2.png";
        var oldman =  new Image();
        oldman.src = "backgrounds/oldman.png";
        var sword =  new Image();
        sword.src = "backgrounds/sword.png";
        var en1 =  new Image();
        en1.src = "backgrounds/mog.jpg";
        var en2 =  new Image();
        en2.src = "backgrounds/muchmega.jpg";

        const pcanvas = document.getElementById("player");
        const pctx = pcanvas.getContext("2d");
        linkdown1.onload = function() {
            pctx.drawImage(linkdown1, playerx, playery, 64, 64);
        } 
//using fancy classes and arrays for hitboxes
class Hitbox {
    constructor(x, y, width, height, name = null) {  // 'name' is optional
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.name = name;  // optional name attribute
    }

    contains(px, py) {
        return px >= this.x && px <= this.x + this.width &&
               py >= this.y && py <= this.y + this.height;
    }

    overlaps(other) {
        return !(this.x + this.width < other.x ||
                 this.x > other.x + other.width ||
                 this.y + this.height < other.y ||
                 this.y > other.y + other.height);
    }
}

var eindex;

let obstacles = [];
const levels = {
    1: [
    new Hitbox(0, 0, 100, 330),
    new Hitbox(100, 0, 100, 230),
    new Hitbox(200, 0, 200, 50),
    new Hitbox(350, 50, 50, 50),
    new Hitbox(560, 0, 440, 340), 
    new Hitbox(0, 410, 115, 340),
    new Hitbox(0, 615, 1000, 135),
    new Hitbox(870, 410, 130, 340),
    new Hitbox(264, 94, 10, 10, "trig1"),
    new Hitbox(0, 0, 1000, 2, "trig2"),
    new Hitbox(998, 0, 2, 1000, "trig2")
    ],
    2: [
    new Hitbox(875, 0, 60, 270),
    new Hitbox(935, 0, 60, 335),
    new Hitbox(873, 474, 57, 276),
    new Hitbox(0, 615, 1000, 135),
    new Hitbox(930, 409, 70, 591),
    new Hitbox(0, 0, 1000, 2, "trig2"),
    new Hitbox(0, 0, 2, 1000, "trig2")
    ],
    3: [
        new Hitbox(475, 426, 20, 50, "sword")
    ]
};
// yaya simple level handling: 
function loadLevel(level) {
    obstacles = levels[level] || [];
}

function changeLevel(newLevel) {
    currentLevel = newLevel;
    loadLevel(newLevel);
}
var hascollided = false;
var swordcol = false; 
function checkCollision(x, y, width, height) {
    const playerHitbox = new Hitbox(x, y, width, height);
    for (let i = 0; i < obstacles.length; i++) {
        if (playerHitbox.overlaps(obstacles[i])) {
            return obstacles[i].name || true;  // Return the name if it exists, otherwise true
        }
    }
    return false;
}

        // The tick update loop. It has the answer to all questions. 
        function tick() {
            // initial level load:

            loadLevel(clevel);

            
               // init them canvases         
            const bgcanvas = document.getElementById("background");
        const bctx = bgcanvas.getContext("2d");
        const guicanvas = document.getElementById("GUI");
        const gctx = guicanvas.getContext("2d");
        const pcanvas = document.getElementById("player");
        const pctx = pcanvas.getContext("2d");
        let coll = false;
            let buff = 0; 
        // just delete the previous frame so u can redraw all the moving elements.
        pctx.clearRect(0, 0, 1000, 7000)
            // change links foot every 5 ticks if he is moving:

                q++; 

                if (q == 15) {
                    footindex = !footindex; 
                    q = 0;

                }
            // collision check ig:

            // update player pos if no collisions are detected (yay no gravity physics to deal with!)
                let newX = playerx;
    let newY = playery;
                
    if (movingdown) {
        newY += 2;
    } else if (movingleft) {
        newX -= 2;
    } else if (movingright) {
        newX += 2;
    } else if (movingup) {
        newY -= 2;
    }
        
    // check for collision before updating the player's position
    const collisionResult = checkCollision(newX, newY, 64, 64);
        // Handle collision result
        if (collisionResult) {
            console.log("can confirm");

        if (typeof collisionResult === 'string') {
            if (collisionResult == 'trig1') {
                clevel = 3; 
                playerx = 450;
                playery = 630;
            } else if (collisionResult == 'trig2') {
                alert("you can't go there...It's 100% totally not because we haven't made the level yet fr fr. If you question this message, you have L rizz.")
                playerx = 500;
                playery = 350;
            } else if (collisionResult == 'sword' && hascollided != true) {
                hascollided = true;
                swordcol = true;
            } else if (collisionResult == 'sword' && hascollided) {
                playerx = newX;
                playery = newY;
            }
            colbefore = true;
        } else {

        }
    } else {
        // No collision, update player position
        playerx = newX;
        playery = newY;
    }
    if (swordon == true) {
        if (swordx > 1000 || swordx < 0 || swordy > 750 || swordy < 0) {
            swordon = false;
        } else {
            swordy -= 4; 
            pctx.drawImage(sword, swordx,swordy, 30, 80);
        }
    }
            // render link (the player canvas is for all non-static objects)

            if (footindex) {
                magic = 1;
            } else {
                magic = 2;
            }
            if (movingdown) {


                pctx.imageSmoothingEnabled = false; 
                if (magic == 1) {
                pctx.drawImage(linkdown1, playerx, playery, 64, 64);
                } else if (magic == 2) {
                    pctx.drawImage(linkdown2, playerx, playery, 64, 64);
                }
                
            } else if (movingup) {
                pctx.imageSmoothingEnabled = false; 
                if (magic == 1) {
                pctx.drawImage(linkup1, playerx, playery, 64, 64);
                } else if (magic == 2) {
                    pctx.drawImage(linkup2, playerx, playery, 64, 64);
                }
            } else if (movingright) {
                pctx.imageSmoothingEnabled = false; 
                if (magic == 1) {
                pctx.drawImage(linkright1, playerx, playery, 64, 64);
                } else if (magic == 2) {
                    pctx.drawImage(linkright2, playerx, playery, 64, 64);
                }
            } else if (movingleft) {

                pctx.imageSmoothingEnabled = false; 
                if (magic == 1) {
                pctx.drawImage(linkl1, playerx, playery, 64, 64);
                } else if (magic == 2) {
                    pctx.drawImage(linkl2, playerx, playery, 64, 64);
                }
            } else {
                
                pctx.imageSmoothingEnabled = false; 

                pctx.drawImage(linkdown1, playerx, playery, 64, 64);

                
            }


            // draw background 

            // draw GUI and stuff yeah. 
            gctx.fillStyle = "black";
            gctx.fillRect(0, 0, 1000, 200);
            gctx.beginPath();
            gctx.lineWidth = "4";
            gctx.strokeStyle = "blue"; 
            gctx.rect(300, 50, 80, 110);
            if (swordcol) {
                gctx.drawImage(sword, 320, 70, 34, 80);
            }
            gctx.stroke();
            gctx.beginPath();
            gctx.lineWidth = "4";
            gctx.strokeStyle = "blue"; 
            gctx.rect(410, 50, 80, 110);
            gctx.stroke();
            gctx.font = "50px Courier New";
            gctx.fillStyle = "white";
            gctx.fillText("B", 320, 62)
            gctx.fillText("A", 430, 62)
            gctx.fillStyle = "red";
            gctx.fillText("LIFE", 670, 62);


                gctx.imageSmoothingEnabled = false;
                switch (lives) {
                    case 0:
                        gameover();
                        break;
                    case 1:
                        gctx.drawImage(heart, 620, 85, 70, 70);
                        break;
                    case 2:
                        gctx.drawImage(heart, 620, 85, 70, 70);
                        gctx.drawImage(heart, 700, 85, 70, 70);
                        break;
                    case 3:
                        gctx.drawImage(heart, 620, 85, 70, 70);
                        gctx.drawImage(heart, 700, 85, 70, 70);
                        gctx.drawImage(heart, 780, 85, 70, 70);
                        break;
                    default: 
                        alert("yea that's not right...");
                }

            
            // keizou if you are reading this... your not a true sigma

            gctx.fillStyle = "white";
            gctx.font = "40px Courier New";

                gctx.imageSmoothingEnabled = false; 
                gctx.drawImage(icons, 50, 10, 40, 180);
                gctx.fillText("X"+rupees.toString(), 95, 67);
                gctx.fillText("X"+keys.toString(), 95, 130);
                gctx.fillText("X"+orbs.toString(), 95, 167);
            // check if they need to move onto a different level:
             if (playerx < 0) {

            switch (clevel) {
                case 1:
                    playerx = 950;
                    clevel = 2; 
                    playery = 340; 
                    renderLevel();

                    break;
                default:
                    alert("something broke.");
            }
        } else if (playerx > 950) {

            switch (clevel) {
                case 2:
                    playerx = 1;
                    clevel = 1; 
                    playery = 336;
                    renderLevel();
                    break;
                default:
                    alert("something broke.");
                    
            }
        } else if ( playery >= 700) {
            switch (clevel) {
                case 3:
                    playerx = 259;
                    playery = 168;
                    clevel = 1;
                    break;
            }
        }
        switch(clevel) {
            case 1:
                bctx.imageSmoothingEnabled = false;
                bctx.drawImage(bg, 0, 0, 1000, 750);

                break;
            case 2:
                bctx.imageSmoothingEnabled = false;
                bctx.drawImage(bg2, 0, 0, 1000, 750);

                break;
            case 3:
                bctx.imageSmoothingEnabled = false;
                bctx.drawImage(oldman, 0, 0, 1000, 750);
                bctx.fillStyle = "white";
                bctx.font = "29px Courier New";
                bctx.fillText("We have determined that you are a ", 140, 223);
                bctx.fillText("true sigma worthy of this sword w rizz", 140, 253);

          
                if (swordcol != true) {
                    pctx.drawImage(sword, 480, 431, 20, 50);
                }
                
        }
        }
    </script>
</body>
</html>